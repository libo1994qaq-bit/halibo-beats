<!doctype html>
<html>
  <head prefix="og:http://ogp.me/ns#">
    <meta charset="utf-8" />
    <!-- å…³é”®ä¿®å¤ï¼šä½¿ç”¨æ­£ç¡®çš„viewportè®¾ç½® -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta http-equiv="cleartype" content="on" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="theme-color" content="#000000" />
    
    <!-- iOS å…¨å±è®¾ç½® -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="HALIBO Beats" />
    
    <!-- ä¸­æ–‡æè¿° -->
    <meta name="description" content="æ•²å‡»èŠ‚å¥ï¼ŒæŒ‘æˆ˜æé™ï¼HALIBO Beats - æ²‰æµ¸å¼éŸ³ä¹èŠ‚å¥æ¸¸æˆã€‚" />

    <link rel="icon" href="./favicon.svg" type="image/svg+xml" />
    <link rel="manifest" href="./manifest.json" />
    <link rel="apple-touch-icon" href="./icon-256.png" />

    <!-- ç½‘ç«™ä¿¡æ¯ -->
    <meta property="og:url" content="https://libo1994qaq-bit.github.io/halibo-beats/" />
    <meta property="og:title" content="HALIBO Beats" />
    <meta property="og:description" content="æ•²å‡»èŠ‚å¥ï¼ŒæŒ‘æˆ˜æé™ï¼HALIBO Beats - æ²‰æµ¸å¼éŸ³ä¹èŠ‚å¥æ¸¸æˆã€‚" />
    <meta property="og:image" content="https://libo1994qaq-bit.github.io/halibo-beats/ogp.png" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="HALIBO Beats" />
    <meta name="twitter:card" content="summary_large_image" />

    <title>HALIBO Beats</title>
    
    <style>
      /* åŸºç¡€æ ·å¼ - å…³é”®ä¿®å¤ï¼šç¡®ä¿100%å¡«å…… */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      html, body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        background-color: #000;
        font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        color: #fff;
        /* å…³é”®ï¼šç¡®ä¿å…¨å±æ—¶æ²¡æœ‰ç©ºç™½ */
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
      }

      /* æ¸¸æˆå®¹å™¨ - å…³é”®ä¿®å¤ï¼šä½¿ç”¨flexç¡®ä¿å†…å®¹å±…ä¸­ */
      #game-container {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        background: #000;
      }

      /* å…³é”®ï¼šæ¸¸æˆç”»å¸ƒå®¹å™¨ï¼Œä¿æŒæ¯”ä¾‹æ‹‰ä¼¸ */
      #game-app {
        width: 100%;
        height: 100%;
        background: #000;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
      }

      /* å¼ºåˆ¶Phaser/Canvasç”»å¸ƒæ‹‰ä¼¸å¹¶ä¿æŒæ¯”ä¾‹ */
      #game-app canvas {
        position: absolute !important;
        max-width: 100% !important;
        max-height: 100% !important;
        width: auto !important;
        height: auto !important;
        object-fit: contain !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
      }

      /* ä¿®å¤ï¼šå…¨å±æ—¶çš„ç‰¹æ®Šæ ·å¼ */
      :fullscreen #game-container,
      :-webkit-full-screen #game-container,
      :-moz-full-screen #game-container,
      :-ms-fullscreen #game-container {
        width: 100vw !important;
        height: 100vh !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        background: #000 !important;
      }

      :fullscreen #game-app,
      :-webkit-full-screen #game-app,
      :-moz-full-screen #game-app,
      :-ms-fullscreen #game-app {
        width: 100% !important;
        height: 100% !important;
        background: #000 !important;
      }

      /* å…³é”®ï¼šå…¨å±æ—¶å¼ºåˆ¶ç”»å¸ƒå¡«æ»¡ */
      :fullscreen #game-app canvas,
      :-webkit-full-screen #game-app canvas,
      :-moz-full-screen #game-app canvas,
      :-ms-fullscreen #game-app canvas {
        max-width: 100vw !important;
        max-height: 100vh !important;
        width: 100% !important;
        height: 100% !important;
        object-fit: cover !important;
      }

      /* æ¨ªå±æç¤º */
      #landscape-warning {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        text-align: center;
        padding: 20px;
        animation: gradientBG 10s ease infinite;
        background-size: 400% 400%;
      }

      @keyframes gradientBG {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }

      .phone-icon {
        width: 150px;
        height: 250px;
        position: relative;
        margin-bottom: 30px;
        animation: phoneRotate 3s ease-in-out infinite;
      }

      .phone-body {
        width: 120px;
        height: 220px;
        background: #111;
        border-radius: 25px;
        position: relative;
        border: 8px solid #333;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      }

      .phone-screen {
        width: 100px;
        height: 160px;
        background: #222;
        border-radius: 15px;
        position: absolute;
        top: 20px;
        left: 10px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .music-bar {
        width: 80%;
        height: 4px;
        background: linear-gradient(90deg, #ff0080, #00ccff);
        margin: 3px 0;
        transform-origin: left;
        animation: musicPulse 1s ease-in-out infinite;
        animation-delay: calc(var(--i) * 0.1s);
      }

      @keyframes musicPulse {
        0%, 100% { transform: scaleX(0.3); }
        50% { transform: scaleX(1); }
      }

      @keyframes phoneRotate {
        0%, 100% { transform: rotate(0deg); }
        25% { transform: rotate(-90deg); }
        50% { transform: rotate(-90deg); }
        75% { transform: rotate(-90deg); }
      }

      .landscape-text {
        font-size: 28px;
        margin-bottom: 15px;
        color: #ff0080;
        text-shadow: 0 0 10px rgba(255, 0, 128, 0.5);
        animation: textGlow 2s ease-in-out infinite;
      }

      @keyframes textGlow {
        0%, 100% { text-shadow: 0 0 10px rgba(255, 0, 128, 0.5); }
        50% { text-shadow: 0 0 20px rgba(255, 0, 128, 0.8), 0 0 30px rgba(0, 204, 255, 0.6); }
      }

      .landscape-subtext {
        font-size: 16px;
        margin-bottom: 30px;
        color: #00ccff;
        max-width: 300px;
        line-height: 1.5;
      }

      .continue-button {
        padding: 15px 35px;
        font-size: 18px;
        font-weight: bold;
        background: linear-gradient(45deg, #ff0080, #00ccff);
        color: white;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 5px 20px rgba(255, 0, 128, 0.4);
        position: relative;
        overflow: hidden;
      }

      .continue-button:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(255, 0, 128, 0.6);
      }

      .continue-button:active {
        transform: translateY(-1px);
      }

      /* å¾®ä¿¡ä¸“ç”¨æç¤º */
      #wechat-warning {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #1a1a1a, #333333, #1a1a1a);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 3000;
        text-align: center;
        padding: 20px;
      }

      .wechat-icon {
        font-size: 60px;
        margin-bottom: 20px;
        animation: wechatPulse 2s ease-in-out infinite;
      }

      @keyframes wechatPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
      }

      .wechat-title {
        font-size: 24px;
        margin-bottom: 15px;
        color: #07C160; /* å¾®ä¿¡ç»¿è‰² */
        font-weight: bold;
      }

      .wechat-instructions {
        background: rgba(7, 193, 96, 0.1);
        border: 2px solid #07C160;
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
        max-width: 320px;
        text-align: left;
      }

      .wechat-instructions ol {
        padding-left: 20px;
        margin-top: 10px;
      }

      .wechat-instructions li {
        margin-bottom: 10px;
        font-size: 14px;
        line-height: 1.5;
      }

      .wechat-tip {
        font-size: 14px;
        color: #aaa;
        margin-top: 20px;
        max-width: 300px;
        line-height: 1.5;
      }

      /* å…¨å±æŒ‰é’® */
      #fullscreen-button {
        position: fixed;
        top: 10px;
        right: 10px;
        z-index: 100;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        border: 2px solid #00ccff;
        padding: 8px 12px;
        border-radius: 20px;
        font-size: 12px;
        cursor: pointer;
        display: none;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        font-weight: bold;
        letter-spacing: 1px;
        text-transform: uppercase;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
      }

      #fullscreen-button:hover {
        background: rgba(0, 204, 255, 0.3);
        border-color: #ff0080;
        transform: scale(1.1);
      }

      #fullscreen-button.fullscreen-active {
        background: rgba(255, 0, 128, 0.3);
        border-color: #ff0080;
      }

      /* å…³é”®ä¿®å¤ï¼šå…¨å±æ—¶éšè—å…¨å±æŒ‰é’® */
      :fullscreen #fullscreen-button,
      :-webkit-full-screen #fullscreen-button,
      :-moz-full-screen #fullscreen-button,
      :-ms-fullscreen #fullscreen-button {
        display: none !important;
      }

      /* å¾®ä¿¡ä¸­éšè—å…¨å±æŒ‰é’® */
      .wechat-mode #fullscreen-button {
        display: none !important;
      }

      /* è¿·ä½ æç¤ºæ¡ */
      .mini-tip {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 204, 255, 0.2);
        border: 1px solid rgba(0, 204, 255, 0.5);
        color: #00ccff;
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 12px;
        display: none;
        z-index: 150;
        backdrop-filter: blur(5px);
        animation: tipPulse 3s ease-in-out infinite;
        max-width: 90%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      @keyframes tipPulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
      }

      /* æ·»åŠ æ·¡å‡ºåŠ¨ç”» */
      @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
      }

      .mini-tip.fade-out {
        animation: fadeOut 0.5s ease forwards;
      }

      /* å¾®ä¿¡æ¨¡å¼ä¸‹çš„ç‰¹æ®Šå¤„ç† */
      .wechat-mode #landscape-warning {
        display: none !important;
      }

      .wechat-mode .mini-tip {
        display: none !important;
      }

      /* æ¨ªå±æ¨¡å¼ä¸‹çš„æ ·å¼è°ƒæ•´ */
      @media (orientation: landscape) {
        #landscape-warning {
          display: none !important;
        }
        
        #fullscreen-button {
          display: block;
        }
        
        .mini-tip {
          display: block;
          animation: tipPulse 3s ease-in-out infinite, fadeOut 0.5s ease 5s forwards;
        }
        
        /* å¾®ä¿¡ä¸­æ¨ªå±æ—¶ä¸æ˜¾ç¤ºå…¨å±æŒ‰é’® */
        .wechat-mode #fullscreen-button {
          display: none !important;
        }
      }

      /* ç«–å±æ¨¡å¼ä¸‹çš„ç‰¹æ®Šå¤„ç† */
      @media (orientation: portrait) {
        #landscape-warning {
          display: flex;
        }
        
        #fullscreen-button {
          display: none;
        }
        
        .mini-tip {
          display: none;
        }
        
        /* å¾®ä¿¡ä¸­ç«–å±æ—¶æ˜¾ç¤ºå¾®ä¿¡æç¤º */
        .wechat-mode #landscape-warning {
          display: none !important;
        }
        
        .wechat-mode #wechat-warning {
          display: flex;
        }
      }

      /* å°å±å¹•é€‚é… */
      @media (max-width: 480px) {
        .phone-icon {
          width: 120px;
          height: 200px;
        }
        
        .phone-body {
          width: 90px;
          height: 170px;
        }
        
        .phone-screen {
          width: 75px;
          height: 120px;
        }
        
        .landscape-text {
          font-size: 22px;
        }
        
        .landscape-subtext {
          font-size: 14px;
          padding: 0 20px;
        }
        
        .continue-button {
          padding: 12px 25px;
          font-size: 16px;
        }
        
        .wechat-title {
          font-size: 20px;
        }
        
        .wechat-instructions {
          padding: 15px;
          margin: 15px 0;
        }
        
        #fullscreen-button {
          padding: 6px 10px;
          font-size: 10px;
          right: 5px;
          top: 5px;
        }
        
        .mini-tip {
          font-size: 10px;
          padding: 6px 12px;
          bottom: 10px;
        }
      }

      /* æ‰‹æœºæ¨ªå±ç‰¹æ®Šä¼˜åŒ– */
      @media (orientation: landscape) and (max-height: 600px) {
        .mini-tip {
          bottom: 5px;
          font-size: 10px;
          padding: 4px 8px;
        }
        
        #fullscreen-button {
          padding: 4px 8px;
          font-size: 10px;
          top: 5px;
          right: 5px;
        }
      }

      /* æ¸¸æˆåŠ è½½æç¤º */
      .game-loading {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #00ccff;
        font-size: 18px;
        text-align: center;
        z-index: 99;
        display: none;
      }

      .loading-dots {
        display: inline-block;
        animation: dots 1.5s steps(5, end) infinite;
      }

      @keyframes dots {
        0%, 20% { content: '.'; }
        40% { content: '..'; }
        60%, 100% { content: '...'; }
      }

      /* éšè—æ»šåŠ¨æ¡ */
      ::-webkit-scrollbar {
        display: none;
      }
      
      /* iOS Safari å…¨å±ä¿®å¤ */
      @supports (-webkit-touch-callout: none) {
        html, body {
          height: -webkit-fill-available;
        }
        
        #game-container {
          height: -webkit-fill-available;
        }
      }
    </style>
  </head>

  <body>
    <!-- æ¨ªå±æç¤º -->
    <div id="landscape-warning">
      <div class="phone-icon">
        <div class="phone-body">
          <div class="phone-screen">
            <div class="music-bar" style="--i: 0;"></div>
            <div class="music-bar" style="--i: 1;"></div>
            <div class="music-bar" style="--i: 2;"></div>
            <div class="music-bar" style="--i: 3;"></div>
            <div class="music-bar" style="--i: 4;"></div>
            <div class="music-bar" style="--i: 5;"></div>
          </div>
        </div>
      </div>
      <div class="landscape-text">ğŸµ ç¿»è½¬è®¾å¤‡ï¼ŒèŠ‚å¥åŠ å€ï¼</div>
      <div class="landscape-subtext">æ¨ªå±æ¨¡å¼å¯è·å¾—æœ€ä½³æ¸¸æˆä½“éªŒ<br>è®©éŸ³ç¬¦åœ¨æ›´å®½çš„èˆå°ä¸Šé£èˆ</div>
      <button id="continue-portrait-button" class="continue-button">
        æˆ‘çŸ¥é“ï¼Œä½†æˆ‘å°±æƒ³ç«–ç€ç©
      </button>
    </div>
    
    <!-- å¾®ä¿¡æµè§ˆå™¨æç¤º -->
    <div id="wechat-warning">
      <div class="wechat-icon">ğŸ’¬</div>
      <div class="wechat-title">å¾®ä¿¡æµè§ˆå™¨æç¤º</div>
      <div class="wechat-instructions">
        <p>æ£€æµ‹åˆ°æ‚¨æ­£åœ¨ä½¿ç”¨å¾®ä¿¡å†…ç½®æµè§ˆå™¨ï¼Œè¯·æ³¨æ„ï¼š</p>
        <ol>
          <li>å¾®ä¿¡ä¸­éƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—é™</li>
          <li>å»ºè®®ç‚¹å‡»å³ä¸Šè§’ <strong>"Â·Â·Â·"</strong> æŒ‰é’®</li>
          <li>é€‰æ‹© <strong>"åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€"</strong></li>
          <li>ç„¶ååœ¨ç³»ç»Ÿæµè§ˆå™¨ä¸­ä½“éªŒå®Œæ•´åŠŸèƒ½</li>
        </ol>
      </div>
      <button id="continue-wechat-button" class="continue-button">
        æˆ‘çŸ¥é“äº†ï¼Œå¼€å§‹æ¸¸æˆ
      </button>
      <div class="wechat-tip">
        å¦‚æœæ¸¸æˆå£°éŸ³æ— æ³•æ’­æ”¾ï¼Œè¯·å…ˆç‚¹å‡»å±å¹•ä»»æ„ä½ç½®
      </div>
    </div>
    
    <!-- æ¸¸æˆå®¹å™¨ -->
    <div id="game-container">
      <button id="fullscreen-button">â›¶ å…¨å±</button>
      <div id="game-app"></div>
      <div class="mini-tip">ğŸµ ç«–å±æ¨¡å¼ä¹Ÿèƒ½ç©ï¼Œä½†æ¨ªå±æ›´çˆ½å“¦ï¼</div>
    </div>
    
    <!-- æ¸¸æˆåŠ è½½æç¤º -->
    <div class="game-loading" id="game-loading">
      <div>åŠ è½½èŠ‚å¥ä¸­<span class="loading-dots"></span></div>
    </div>

    <script src="./bundle.js"></script>
    
    <script>
      // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
      document.addEventListener('DOMContentLoaded', function() {
        // è·å–DOMå…ƒç´ 
        const landscapeWarning = document.getElementById('landscape-warning');
        const wechatWarning = document.getElementById('wechat-warning');
        const gameContainer = document.getElementById('game-container');
        const continuePortraitButton = document.getElementById('continue-portrait-button');
        const continueWechatButton = document.getElementById('continue-wechat-button');
        const fullscreenButton = document.getElementById('fullscreen-button');
        const gameApp = document.getElementById('game-app');
        const miniTip = document.querySelector('.mini-tip');
        const gameLoading = document.getElementById('game-loading');
        
        // æ£€æµ‹æ˜¯å¦åœ¨å¾®ä¿¡æµè§ˆå™¨ä¸­
        function isWechatBrowser() {
          const ua = navigator.userAgent.toLowerCase();
          return ua.indexOf('micromessenger') !== -1;
        }
        
        // å¾®ä¿¡æµè§ˆå™¨ç‰¹æ®Šå¤„ç†
        const isWechat = isWechatBrowser();
        
        if (isWechat) {
          console.log('æ£€æµ‹åˆ°å¾®ä¿¡æµè§ˆå™¨ï¼Œå¯ç”¨ç‰¹æ®Šå¤„ç†æ¨¡å¼');
          document.body.classList.add('wechat-mode');
          
          // å¾®ä¿¡ä¸­ç«‹å³æ˜¾ç¤ºå¾®ä¿¡æç¤º
          setTimeout(() => {
            wechatWarning.style.display = 'flex';
            landscapeWarning.style.display = 'none';
          }, 500);
          
          // å¾®ä¿¡ä¸­éšè—å…¨å±æŒ‰é’®
          fullscreenButton.style.display = 'none';
        }
        
        // æ£€æµ‹æ˜¯å¦æ¨ªå± - å¾®ä¿¡ä¸“ç”¨ç‰ˆæœ¬
        function isLandscape() {
          // å¾®ä¿¡ä¸­å¯èƒ½éœ€è¦æ›´ç²¾ç¡®çš„æ£€æµ‹
          if (window.orientation !== undefined) {
            // ä½¿ç”¨orientationå±æ€§
            return Math.abs(window.orientation) === 90;
          } else {
            // ä½¿ç”¨å®½é«˜æ¯”åˆ¤æ–­
            return window.innerWidth > window.innerHeight;
          }
        }
        
        // æ£€æŸ¥æ¨ªå±çŠ¶æ€å¹¶æ›´æ–°UI - å¾®ä¿¡ä¸“ç”¨ç‰ˆæœ¬
        function checkOrientation() {
          if (isWechat) {
            // å¾®ä¿¡ä¸­ï¼šç›´æ¥éšè—æ‰€æœ‰æç¤ºï¼Œè®©ç”¨æˆ·é€šè¿‡æŒ‰é’®æ§åˆ¶
            // ä½†æˆ‘ä»¬è¿˜æ˜¯å°è¯•æ£€æµ‹æ¨ªå±
            if (isLandscape()) {
              console.log('å¾®ä¿¡ä¸­æ£€æµ‹åˆ°æ¨ªå±');
              landscapeWarning.style.display = 'none';
              wechatWarning.style.display = 'none';
              fullscreenButton.style.display = 'none'; // å¾®ä¿¡ä¸­ä¸æ˜¾ç¤ºå…¨å±æŒ‰é’®
            } else {
              console.log('å¾®ä¿¡ä¸­æ£€æµ‹åˆ°ç«–å±');
              // å¾®ä¿¡ç«–å±æ—¶æ˜¾ç¤ºå¾®ä¿¡æç¤º
              wechatWarning.style.display = 'flex';
              landscapeWarning.style.display = 'none';
              fullscreenButton.style.display = 'none';
            }
          } else {
            // éå¾®ä¿¡æµè§ˆå™¨ï¼šä½¿ç”¨åŸæœ‰é€»è¾‘
            if (isLandscape()) {
              landscapeWarning.style.display = 'none';
              fullscreenButton.style.display = 'block';
              miniTip.style.display = 'block';
              
              // 5ç§’åè‡ªåŠ¨éšè—æç¤º
              setTimeout(() => {
                if (miniTip.style.display === 'block') {
                  miniTip.classList.add('fade-out');
                  setTimeout(() => {
                    miniTip.style.display = 'none';
                    miniTip.classList.remove('fade-out');
                  }, 500);
                }
              }, 5000);
            } else {
              landscapeWarning.style.display = 'flex';
              fullscreenButton.style.display = 'none';
              miniTip.style.display = 'none';
            }
          }
        }
        
        // å¾®ä¿¡ä¸“ç”¨çš„æ¨ªå±æ£€æµ‹ï¼ˆä½¿ç”¨è½®è¯¢ï¼‰
        let wechatOrientationCheckInterval = null;
        
        function startWechatOrientationCheck() {
          if (isWechat && !wechatOrientationCheckInterval) {
            console.log('å¯åŠ¨å¾®ä¿¡æ¨ªå±æ£€æµ‹è½®è¯¢');
            // æ¯500æ¯«ç§’æ£€æŸ¥ä¸€æ¬¡æ–¹å‘
            wechatOrientationCheckInterval = setInterval(checkOrientation, 500);
          }
        }
        
        function stopWechatOrientationCheck() {
          if (wechatOrientationCheckInterval) {
            clearInterval(wechatOrientationCheckInterval);
            wechatOrientationCheckInterval = null;
          }
        }
        
        // è°ƒæ•´æ¸¸æˆç”»å¸ƒå°ºå¯¸
        function adjustGameCanvas() {
          setTimeout(() => {
            const canvas = gameApp.querySelector('canvas');
            if (canvas) {
              console.log('æ‰¾åˆ°æ¸¸æˆç”»å¸ƒï¼Œè°ƒæ•´å°ºå¯¸');
              
              // è·å–å®¹å™¨å°ºå¯¸
              const containerWidth = gameContainer.clientWidth;
              const containerHeight = gameContainer.clientHeight;
              
              // è·å–ç”»å¸ƒåŸå§‹å°ºå¯¸
              const originalWidth = canvas.width || 1280;
              const originalHeight = canvas.height || 720;
              
              // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
              const scaleX = containerWidth / originalWidth;
              const scaleY = containerHeight / originalHeight;
              const scale = Math.max(scaleX, scaleY);
              
              // è®¡ç®—æ–°å°ºå¯¸ï¼ˆä¿æŒæ¯”ä¾‹ï¼‰
              const newWidth = Math.floor(originalWidth * scale);
              const newHeight = Math.floor(originalHeight * scale);
              
              // è®¾ç½®ç”»å¸ƒæ˜¾ç¤ºå°ºå¯¸
              canvas.style.width = newWidth + 'px';
              canvas.style.height = newHeight + 'px';
              canvas.style.left = '50%';
              canvas.style.top = '50%';
              canvas.style.transform = 'translate(-50%, -50%)';
              canvas.style.position = 'absolute';
              
              console.log(`ç”»å¸ƒè°ƒæ•´: ${originalWidth}x${originalHeight} -> ${newWidth}x${newHeight}, ç¼©æ”¾: ${scale}`);
            } else {
              console.log('æœªæ‰¾åˆ°æ¸¸æˆç”»å¸ƒï¼Œ1ç§’åé‡è¯•');
              setTimeout(adjustGameCanvas, 1000);
            }
          }, 1000);
        }
        
        // å…¨å±åˆ‡æ¢å‡½æ•°
        function toggleFullscreen() {
          if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {
            // è¿›å…¥å…¨å±
            const element = document.documentElement;
            
            // å¾®ä¿¡ä¸­ä¸æ‰§è¡Œå…¨å±
            if (isWechat) {
              alert('å¾®ä¿¡æµè§ˆå™¨ä¸æ”¯æŒå…¨å±åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨ç³»ç»Ÿæµè§ˆå™¨æ‰“å¼€');
              return;
            }
            
            // æ·»åŠ è§†è§‰åé¦ˆ
            fullscreenButton.classList.add('fullscreen-active');
            fullscreenButton.innerHTML = 'â›¶ é€€å‡º';
            
            // æ˜¾ç¤ºåŠ è½½æç¤º
            gameLoading.style.display = 'block';
            
            // æ‰§è¡Œå…¨å±
            const requestFullscreen = element.requestFullscreen || 
                                     element.webkitRequestFullscreen || 
                                     element.msRequestFullscreen;
            
            if (requestFullscreen) {
              requestFullscreen.call(element).then(() => {
                console.log('è¿›å…¥å…¨å±æˆåŠŸ');
                
                setTimeout(() => {
                  adjustGameCanvas();
                  gameLoading.style.display = 'none';
                }, 500);
              }).catch(err => {
                console.log('å…¨å±è¯·æ±‚å¤±è´¥:', err);
                gameLoading.style.display = 'none';
                fullscreenButton.classList.remove('fullscreen-active');
                fullscreenButton.innerHTML = 'â›¶ å…¨å±';
              });
            }
          } else {
            // é€€å‡ºå…¨å±
            fullscreenButton.classList.remove('fullscreen-active');
            fullscreenButton.innerHTML = 'â›¶ å…¨å±';
            
            const exitFullscreen = document.exitFullscreen || 
                                   document.webkitExitFullscreen || 
                                   document.msExitFullscreen;
            
            if (exitFullscreen) {
              exitFullscreen.call(document).then(() => {
                setTimeout(adjustGameCanvas, 300);
                checkOrientation();
              });
            }
          }
        }
        
        // äº‹ä»¶ç›‘å¬
        continuePortraitButton.addEventListener('click', function() {
          landscapeWarning.style.display = 'none';
          
          // æ·»åŠ ä¸€ä¸ªå°çš„è§†è§‰åé¦ˆ
          this.style.transform = 'scale(0.95)';
          setTimeout(() => {
            this.style.transform = 'scale(1)';
          }, 200);
          
          // æ˜¾ç¤ºæç¤ºä¿¡æ¯ï¼ˆ5ç§’åè‡ªåŠ¨æ¶ˆå¤±ï¼‰
          miniTip.textContent = 'ğŸµ ç«–å±æ¨¡å¼ä¹Ÿèƒ½ç©ï¼Œä½†æ¨ªå±æ›´çˆ½å“¦ï¼';
          miniTip.style.display = 'block';
          setTimeout(() => {
            if (miniTip.style.display === 'block') {
              miniTip.classList.add('fade-out');
              setTimeout(() => {
                miniTip.style.display = 'none';
                miniTip.classList.remove('fade-out');
              }, 500);
            }
          }, 5000);
          
          // è°ƒæ•´ç”»å¸ƒå°ºå¯¸
          setTimeout(adjustGameCanvas, 500);
        });
        
        continueWechatButton.addEventListener('click', function() {
          wechatWarning.style.display = 'none';
          landscapeWarning.style.display = 'none';
          
          // å¾®ä¿¡ä¸­å¼€å§‹æ¨ªå±æ£€æµ‹è½®è¯¢
          startWechatOrientationCheck();
          
          // è°ƒæ•´ç”»å¸ƒå°ºå¯¸
          setTimeout(adjustGameCanvas, 500);
          
          // å¾®ä¿¡ä¸­éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾éŸ³é¢‘
          // è§¦å‘ä¸€æ¬¡æ¸¸æˆç‚¹å‡»äº‹ä»¶
          setTimeout(() => {
            const clickEvent = new MouseEvent('click', {
              view: window,
              bubbles: true,
              cancelable: true
            });
            gameApp.dispatchEvent(clickEvent);
          }, 100);
        });
        
        fullscreenButton.addEventListener('click', toggleFullscreen);
        
        // ç›‘å¬å…¨å±çŠ¶æ€å˜åŒ–
        document.addEventListener('fullscreenchange', function() {
          if (document.fullscreenElement) {
            fullscreenButton.classList.add('fullscreen-active');
            fullscreenButton.innerHTML = 'â›¶ é€€å‡º';
            fullscreenButton.style.display = 'none';
            miniTip.style.display = 'none';
            
            setTimeout(() => {
              adjustGameCanvas();
            }, 100);
          } else {
            fullscreenButton.classList.remove('fullscreen-active');
            fullscreenButton.innerHTML = 'â›¶ å…¨å±';
            miniTip.style.display = 'none';
            
            setTimeout(() => {
              if (isLandscape()) {
                fullscreenButton.style.display = 'block';
                miniTip.style.display = 'block';
                setTimeout(() => {
                  if (miniTip.style.display === 'block') {
                    miniTip.classList.add('fade-out');
                    setTimeout(() => {
                      miniTip.style.display = 'none';
                      miniTip.classList.remove('fade-out');
                    }, 500);
                  }
                }, 5000);
              }
            }, 100);
          }
        });
        
        document.addEventListener('webkitfullscreenchange', function() {
          if (document.webkitFullscreenElement) {
            fullscreenButton.classList.add('fullscreen-active');
            fullscreenButton.innerHTML = 'â›¶ é€€å‡º';
            fullscreenButton.style.display = 'none';
            miniTip.style.display = 'none';
          } else {
            fullscreenButton.classList.remove('fullscreen-active');
            fullscreenButton.innerHTML = 'â›¶ å…¨å±';
            miniTip.style.display = 'none';
            
            setTimeout(() => {
              if (isLandscape()) {
                fullscreenButton.style.display = 'block';
                miniTip.style.display = 'block';
                setTimeout(() => {
                  if (miniTip.style.display === 'block') {
                    miniTip.classList.add('fade-out');
                    setTimeout(() => {
                      miniTip.style.display = 'none';
                      miniTip.classList.remove('fade-out');
                    }, 500);
                  }
                }, 5000);
              }
            }, 100);
          }
        });
        
        // ç›‘å¬æ¨ªç«–å±å˜åŒ– - å¾®ä¿¡ä¸­å¯èƒ½ä¸è§¦å‘
        window.addEventListener('resize', function() {
          checkOrientation();
          setTimeout(adjustGameCanvas, 300);
        });
        
        // å¾®ä¿¡ä¸­ç›‘å¬orientationchangeå¯èƒ½æ— æ•ˆï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨è½®è¯¢
        if (!isWechat) {
          window.addEventListener('orientationchange', function() {
            setTimeout(() => {
              checkOrientation();
              adjustGameCanvas();
            }, 100);
          });
        }
        
        // é˜²æ­¢è§¦æ‘¸é»˜è®¤è¡Œä¸ºï¼ˆé¿å…ç¼©æ”¾ï¼‰
        document.addEventListener('touchstart', function(e) {
          if (e.touches.length > 1) {
            e.preventDefault();
          }
        }, { passive: false });
        
        document.addEventListener('gesturestart', function(e) {
          e.preventDefault();
        });
        
        // é˜²æ­¢åŒå‡»ç¼©æ”¾
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
          const now = Date.now();
          if (now - lastTouchEnd <= 300) {
            e.preventDefault();
          }
          lastTouchEnd = now;
        }, false);
        
        // åˆå§‹æ£€æŸ¥
        checkOrientation();
        
        // å¾®ä¿¡ä¸­ç«‹å³å¼€å§‹æ¨ªå±æ£€æµ‹è½®è¯¢
        if (isWechat) {
          startWechatOrientationCheck();
        } else {
          // éå¾®ä¿¡æµè§ˆå™¨ï¼šå¦‚æœå·²ç»æ˜¯æ¨ªå±ï¼Œæ˜¾ç¤ºæç¤ºï¼ˆ5ç§’åæ¶ˆå¤±ï¼‰
          if (isLandscape()) {
            setTimeout(() => {
              miniTip.style.display = 'block';
              setTimeout(() => {
                if (miniTip.style.display === 'block') {
                  miniTip.classList.add('fade-out');
                  setTimeout(() => {
                    miniTip.style.display = 'none';
                    miniTip.classList.remove('fade-out');
                  }, 500);
                }
              }, 5000);
            }, 1000);
          }
        }
        
        // åˆå§‹è°ƒæ•´ç”»å¸ƒå°ºå¯¸
        setTimeout(adjustGameCanvas, 2000);
        
        // æ³¨å†ŒService Worker
        if ('serviceWorker' in navigator && !isWechat) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('./service-worker.js').catch(error => {
              console.log('Service Worker æ³¨å†Œå¤±è´¥:', error);
            });
          });
        }
        
        // æä¾›å…¨å±€å‡½æ•°ä¾›bundle.jsè°ƒç”¨
        window.toggleFullscreen = toggleFullscreen;
        window.checkOrientation = checkOrientation;
        window.adjustGameCanvas = adjustGameCanvas;
        window.isWechatBrowser = isWechatBrowser;
      });
    </script>
  </body>
</html>